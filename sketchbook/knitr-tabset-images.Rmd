---
title: "Tabset Images"
author: "Josh Cowley"
output:
  html_document:
    keep_md: true
    number_sections: true
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
params:
  session_info: TRUE
---

```{r setup, include = FALSE}
library(purrr)
library(ggplot2)
library(magrittr)
library(knitr)
```

# Setup

Create a list of `ggplot`(s).

```{r}
knitr::opts_chunk$set(
  echo = FALSE,
  fig.asp = 0.8
)

nms <- c("Sepal.Width", "Petal.Length", "Petal.Width")

p_all <- 
  ggplot2::ggplot(
    iris,
    ggplot2::aes(x = .data$Sepal.Length, col = .data$Species)
  )

plts <- 
  purrr::set_names(as.list(nms)) %>%
  purrr::map(~ p_all + ggplot2::geom_point(ggplot2::aes_string(y = .x))) 
```

Define a chunk to create plots but hide them

```{r plot-lbl, fig.show = "hide", results = "hide"}
plts
```

# Show Plots

Programmatically, we can do this, looping over each number

```{r}
knitr::include_graphics(knitr::fig_chunk("plot-lbl", "png", 1))
```

# Function

We want a function to re-create this, arguments needed are 

```{r}
fn <- function(x, level) {
  if (!is.list(x) | is.null(names(x))) stop("'x' should be a named list")
  arg_name <- deparse(substitute(x))
  
  if (missing(level)) stop("Heading 'level' argument required")
  hn <- paste(rep("#", level), collapse = "")
  
  src <- 
    purrr::map(names(x), function(.nm) {
      knitr::knit_expand(
        text = paste(
          "{{hn}} {{.nm}} \n",
          "```{r {{arg_name}}-tab-{{.nm}}}",
          "x${{.nm}}",
          "``` \n\n",
          sep = "\n"
        )
      )
    })
  
  res <- 
    knitr::knit_child(
      text = unlist(src),
      envir = rlang::current_env(),
      quiet = TRUE
    )
  
  cat(res, sep = "\n")
}
```

# Tabs? {.tabset}

```{r, results = "asis"}
fn(plts, 2)
```
